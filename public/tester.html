<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Logged In/Out Test</title>
    <style>
        #loginStatus{
            font-size:  125%;
            font-weight:  bolder;
        }
    </style>
</head>

<body class="container">
    <p>
        This page wants you to be logged into DLA.  It will perform the checks and message you.
        <a target="_blank" href="/login.html">Login here</a>, then refresh the page.
    </p>
    <div id="loginStatus"> YOU ARE NOT LOGGED IN </div>
    <script type="text/javascript">
        checkIfLoggedIn()
        function checkIfLoggedIn(){
            /**
             * So then what is this even?  This user logged in elsewhere and obtained a good access token that will live until it expires or they log out. What is our mechanism for storing and checking the token?  We using localStorage or sessionStorage or cookies?
             *
             * We will hit dunbar-users/userinfo which will either return a user profile or an error (401/403) to signify we are not logged in.
             */ 
            if(sessionStorage.getItem('Agent-URI') || localStorage.getItem("Agent-URI")){
                //Check if it is dead
                fetch('/client/dunbar-user?access_token='+getURLHash("access_token"))
                .then(res => res.json())
                .then(u => {
                    loginStatus.innerHTML = "You are logged in"
                    return true
                })
                .catch(err =>{
                    loginStatus.innerHTML = "You are an unknown entity"
                    return false
                }) 
            }
            else{
                //Well if it's not then then you screwed up, you're not logged in on this browser.
                loginStatus.innerHTML = "You are an unknown entity"
                return false
            }
            
        }
    </script>
</body>

</html>
