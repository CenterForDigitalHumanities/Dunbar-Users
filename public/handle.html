<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
    <script type="text/javascript">
        /**
         * The redirect from the auth0 Universal Login widget for Dunbar Users comes here.
         * It will have all the auth0 hash variables, as well as where to go next all in the URL.
         */ 
        const myURL = document.location.href
        if (myURL.indexOf("state") > -1) {
            let state = getURLHash("state")
            let currentHash = location.hash
            //Whats do you want to do if app_redirect is not present?  We would be stuck on this page and not know what app to go to with the token.
            if(localStorage.getItem(state)){
                let json = JSON.parse(localStorage.getItem(state))
                let redirect = json.redirectURL
                localStorage.removeItem(state)
                document.location.href = redirect + currentHash
            }
        }

        /**
         * Auth0 redirects here with a bunch of info in hash variables.
         * This function allows you pull a single variable from the hash
         */  
        function getURLHash(variable, url=document.location.href) {
            var query = url.substr(url.indexOf("#")+1)
            var vars = query.split("&")
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=")
                if (pair[0] == variable) { return pair[1] }
            }
            return false
        }

    </script>
</body>

</html>
